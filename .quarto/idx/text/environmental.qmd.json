{"title":"Environmental","markdown":{"yaml":{"title":"Environmental","execute":{"warning":false,"error":false},"filters":["lightbox"],"lightbox":"auto","bibliography":"references.bib"},"headingText":"Data","containsRefs":false,"markdown":"\n\n```{r}\n#| label: data-load\n#| include: false\nlibrary(here)\n\nsource(here::here('R', '00_loadpackages.R'))\nsource(here::here('R', '02.2_load_wrangle_WQ-and-MET.R'))\n\nload(here('output','data', 'MET.Rdata'))\n\nload(here('output','data', 'pi_wq.Rdata'))\nload(here('output','data', 'ss_wq.Rdata'))\nload(here('output','data', 'fm_wq.Rdata'))\nload(here('output','data', 'pc_wq.Rdata'))\n```\n\nThe following includes variables that establish the estuarine setting: rainfall, light intensity, water temperature, and salinity. These variables are driven primarily by climatic patterns and largely influence water quality, biological processes, and habitat condition.\n\n<!-- ## Summary -->\n<!-- Winter storm Finn (unofficially named) brought rainfall and strong winds in [January](https://www.actionnewsjax.com/news/local/strong-storm-cold-front-will-move-across-northeast-florida-southeast-georgia/DNJ3SOGJ35G4FCKJLPJNP67YZY/) to Northeast Florida causing some local schools to release students early and cancel after school activities (@fig-rainfall-1; @fig-rainfall-2). This event is discussed in further detail in the next chapter. -->\n\n<!-- Total measured rainfall in 2024 was 1347.2 mm (@fig-SeptPrecip-3). The third quarter of the year had the greatest rainfall total (@fig-rainfall) because of September, which had a record-setting high monthly total (@tbl-topRain; @fig-SeptPrecip-1; @fig-SeptPrecip-2). September also had the greatest number of rain days exceeding 10 mm/day (@Fig-rainfall-3), and more storms producing heavy rainfall (@Fig-rainfall-4). Rainfall totals for the fourth quarter of 2024 are incomplete, resulting from a computer program error. Data are missing beginning November 13, 2024, and continuing through the end of the year (see Maintenance Notes Section 8.2.2; @fig-SeptPrecip-4). -->\n\n<!-- Light intensity was highest from April to August. December had the lowest mid-day photosynthetically active radiation (PAR) (@fig-lightintensity). -->\n\n<!-- Daily average air temperatures were highest from June - August, and most variable during January – April and November – December (@fig-range-atemp). -->\n\n<!-- While there were some low water temperatures throughout the year, daily average water temperatures were generally higher than average (@fig-range-temp). Water temperature decreased in August and September with the onset of the large rain events causing water temperatures to fall below the historic average daily range at all four stations (@fig-range-temp-2; @fig-range-temp-3). Water temperatures increased at all four stations in November nearing the historic 2002-2024 maximum daily range  (@fig-range-temp). -->\n\n<!-- Rainfall in January and September – November brought salinity levels lower than their average daily ranges (@fig-range-sal), particularly at the stations farthest from the inlets (@fig-range-sal-1; @fig-range-sal-4). However, the drought conditions during spring increased salinity levels. Salinity stayed higher than the average daily range at all stations through July, but was most pronounced at Pine Island (@fig-range-sal-1).  -->\n\n\n### Rainfall\n\n```{r}\n#| label: fig-rainfall\n#| echo: false\n#| fig.cap: Rainfall at the Pellicer Creek weather station. See Maintenance Notes (8.2.2) for details on missing data.\n#| fig.subcap:\n#|    - \"Quarterly total precipitation for 2025.\"\n#|    - \"Monthly total precipitation for 2025.\"\n#|    - \"Daily rainfall totals for days with greater than 1mm per day.\"\n#|    - \"Hourly rainfall intensity counts by category per month.\"\n#| layout-ncol: 2\n\n\n# QUARTERLY ----\n\nMET |> \n  SWMPrExtension::seasonal_barplot(param = 'totprcp',\n                                   season_grps = list(c(1,2,3), \n                                                      c(4,5,6), \n                                                      c(7,8,9), \n                                                      c(10, 11, 12)),\n                                   season_names = c('Jan-Mar', \n                                                    'Apr-Jun', \n                                                    'Jul-Sep', \n                                                    'Oct-Dec'),\n                                   hist_rng = c(2003,2025),\n                                   hist_avg = TRUE,\n                                   converted = F) + \n  theme(axis.text.x = element_text(angle = 45,\n                                   vjust = 0.6),\n        axis.text = element_text(color = \"black\"))\n\n\n## MONTHLY ----\n\nMET |> \n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>%\n  # mutate(date = as.Date(datetimestamp),\n  #        month = lubridate::month(date, label = T)) %>% \n  mutate(date = lubridate::date(datetimestamp),\n         month = lubridate::month(datetimestamp, label = TRUE)) %>% \n  group_by(month) %>%\n  summarise(sum = sum(totprcp, na.rm = T)) %>%\n  # summarise(mean = mean(sum)) %>%\n  ggplot(aes(x = month, y = sum)) +\n  geom_col(fill = \"#0075AC\") +\n  geom_hline(yintercept = 121.2, linewidth = 1, linetype = \"dashed\", color = \"grey50\") +\n  geom_text(aes(label = sum), vjust = 1.5, color = \"white\") +\n  scale_y_continuous(expand = c(0,0)) +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  # geom_text(aes(x = \"Mar\", y = 75), \n  #           label = \"69.8 mm\",\n  #           size = 4.5,\n  #           color = \"grey50\") +\n  labs(x = '',\n       y = 'Precipitation (mm)',\n       caption = \"Hortizontal line represents monthly average.\")\n\n## DAILY ----\n\nfun_in <- function(x) sum(x, na.rm = TRUE)\n\nMET |> \n  filter(datetimestamp > '2025-01-01 00:15' & datetimestamp < '2025-11-01 00:00') %>%\n  aggreswmp(by = \"days\", FUN = fun_in, params = \"totprcp\") %>% \n  filter(totprcp >= 1) %>% \n  mutate(date = as.Date(datetimestamp),\n         month = lubridate::month(date, label = T),\n         prcp_in = totprcp * 0.0393701,\n         prcp_in = round(prcp_in, digits = 1),\n         wet = case_when(totprcp < 10 ~ \"Not Very Wet (<10mm)\",\n                         totprcp >= 10 & totprcp < 20 ~ \"Wet (10-19mm)\",\n                         totprcp >= 20 & totprcp < 30 ~ \"Very Wet (20-29mm)\",\n                         totprcp > 30 ~ \"Extremely Wet (>30mm)\"),\n         wet = factor(wet, levels = c(\"Not Very Wet (<10mm)\",\n                                      \"Wet (10-19mm)\",\n                                      \"Very Wet (20-29mm)\",\n                                      \"Extremely Wet (>30mm)\"))) %>% \n  ggplot(aes(x = date, y = totprcp)) +\n  geom_segment(aes(x = date, xend = date, y = 0, yend = totprcp),\n               size = 1) +\n  geom_point(aes(color = wet), size =2, bg = 4) +\n  khroma::scale_color_okabeito() + # change color codes\n  scale_y_continuous(expand = c(0,0), limits = c(0,70)) +\n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\") +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  labs(x = '',\n       y = 'Total Daily Precipitation (mm)',\n       color = \"Amount of Rain\")\n\n## INTENSITY ----\n\n# rainfall intensity \n# in mm/hr\n\nfun_in <- function(x) sum(x, na.rm = TRUE)\n\nMET |>\n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>% \n  aggreswmp(by = \"hours\", FUN = fun_in, params = \"totprcp\") %>% \n  rename(intensity = totprcp) %>% \n  mutate(date = lubridate::date(datetimestamp),\n         month = lubridate::month(datetimestamp, label = TRUE),\n         intensity_cat = case_when(intensity == 0 ~ \"No Rain (0 mm/hr)\",\n                                    intensity > 0 & intensity < 2.5 ~ \"Light Rain (<2.5 mm/hr)\",\n                                    intensity >= 2.5 & intensity < 7.6 ~ \"Moderate Rain (2.5-7.6 mm/hr)\",\n                                    intensity >= 7.6 & intensity < 50 ~ \"Heavy Rain (7.6-50 mm/hr)\",\n                                    intensity > 30 ~ \"Intense Rain (>50mm/hr)\"),\n         intensity_cat = factor(intensity_cat, levels = c(\"No Rain (0 mm/hr)\",\n                                                          \"Light Rain (<2.5 mm/hr)\",\n                                                          \"Moderate Rain (2.5-7.6 mm/hr)\",\n                                                          \"Heavy Rain (7.6-50 mm/hr)\",\n                                                          \"Intense Rain (>50mm/hr)\")\n                                )\n         ) %>% \n  # group_by(month, intensity_cat) %>%\n  # count() %>%\n  filter(intensity_cat != \"No Rain (0 mm/hr)\") %>% \n  ggplot() +\n  geom_bar(aes(x = month, fill = intensity_cat)) +\n  ggthemes::scale_fill_colorblind() +\n  scale_y_continuous(expand = c(0,0)) +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  labs(x = \"\",\n       y = \"Amount of Hours\",\n       fill = \"Intensity Category\")\n```\n\n```{r}\n#| label: tbl-topRain\n#| echo: false\n#| tbl-cap: \"Top five highest monthly rainfall totals.\"\n\n# MET %>% \n#   (filter(datetimestamp < '2026-01-01 00:00'))\n\nMonthly_PRCP<-aggreswmp(MET, 'months', function(x) sum(x, na.rm = T), \nparams = 'totprcp')\n\nMonthly_PRCP$Month <- format(Monthly_PRCP$datetimestamp, \"%b\")\nMonthly_PRCP$Year <- year(Monthly_PRCP$datetimestamp)\nMonthly_PRCP$Month_number <- month(Monthly_PRCP$datetimestamp)\n\nTopValues <- Monthly_PRCP %>% \n  top_n(5, totprcp) %>%\n  arrange(desc(totprcp)) \n\nTopValues %>%\n  select(Month,Year,totprcp) %>% \n  rename(`Total Precipitation (mm)` = 'totprcp') %>% \n  kbl(align = \"c\") %>%\n  kable_styling(fixed_thead = T) %>% \n  column_spec(3, border_left = T)\n\n```\n\n```{r}\n#| label: fig-SeptPrecip\n#| echo: false\n#| fig.cap: Rainfall at the Pellicer Creek weather station.\n#| fig.subcap:\n#|    - \"Monthly total precipitation 2002-2025.\"\n#|    - \"Annual precipitation totals Jan 2002-Dec 2024.\"\n#|    #|    - \"Total precipitation for September 2002-2024.\"\n#|    #|    - \"Annual precipitation totals Jan 2002-Dec 2024.\"\n#| layout-ncol: 2\n# ## September Precip ----\n# \n# Monthly_PRCP %>%\n#   filter(Month == \"Sep\", na.rm=TRUE) %>%\n#   ggplot(aes(Year, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   #scale_x_date(date_labels = \"%y\") +\n#   labs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n## MONTHLY/YEAR ----\n\n# Plotting\nggplot(Monthly_PRCP, aes(datetimestamp, totprcp)) +\n  geom_segment(aes(x=datetimestamp, xend=datetimestamp, y=0, yend=totprcp), colour = \"#0075AC\") +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\nlabs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n## Seasonal Precip ----\n# seasonal_barplot(MET, param = 'totprcp')\n\n## BOXPLOT ----\n# raw_boxplot(MET, param = 'totprcp')\n\n# seasonal_boxplot(MET, param = 'totprcp', target_yr = 2024)\n\n# box_rain <- ggplot(Monthly_PRCP, aes(x = Month, y = totprcp, fill = Month)) + \n#   geom_boxplot(fill = \"#56B4E9\") +\n#   scale_x_discrete(limits = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec')) +\n#   geom_point(data = filter(Monthly_PRCP, Year == 2024), \n#                  aes(color = \"2024\"), size = 4) +\n#   scale_color_manual(name = \"\", values = c(\"2024\" = \"red\")) +\n#   scale_fill_manual(name = \"\", values = c(\"2002-2024\" = \"white\")) +\n#   theme_classic() +\n#   theme(legend.position = \"bottom\", axis.text = element_text(color = \"black\", size = 12),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   labs(x = '',\n#        y = 'Precipitation (mm)')\n#   box_rain\n\n#Boxplots another way\n\nboxplot_prcp <- ggplot(data = Monthly_PRCP, \n                      aes(x = Month, y = totprcp)) +\n      geom_boxplot(data = filter(Monthly_PRCP, Year < 2025), \n                   aes(fill = \"2002-2024\")) +\n      geom_point(data = filter(Monthly_PRCP, Year == 2025), \n                 aes(color = \"2025\"),\n                 size = 4) +\n      scale_x_discrete(limits = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec')) +\n      scale_color_manual(name = \"\", \n                         values = c(\"2025\" = \"red\")) +\n      scale_fill_manual(name = \"\",\n                        values = c(\"2002-2025\" = \"white\")) +\n      theme_classic() +\n      theme(legend.position = \"bottom\",\n            axis.text = element_text(color = \"black\")) +\n      labs(x = \"\", y = 'Precipitation (mm)')\n    boxplot_prcp\n\n## YEAR ----\n\n# Plotting\n\n# fun_in <- function(x) sum(x, na.rm = TRUE)\n# \n# MET |> \n#   filter(datetimestamp > '2003-01-01 00:15' & datetimestamp < '2025-01-01 00:00') %>%\n#   aggreswmp(by = \"years\", FUN = fun_in, params = \"totprcp\") %>% \n#   ggplot(aes(datetimestamp, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   geom_text(aes(label = totprcp), vjust = -0.5, color = \"black\", size = 2) +\n#   labs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n#Another way\n\n# Monthly_PRCP %>%\n#   ggplot(aes(Year, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   geom_text(aes(label = totprcp), vjust = 1.5, color = \"white\") +\n#   #scale_x_date(date_labels = \"%y\") +\n#   labs(title = \"\", x = \"\", y = \"Total Annual Precipitation (mm)\")\n\n\n```\n\n### Light Intensity\n\nThe plot below is interactive. Clicking on elements in the legend (months) will select or deselect months of interest. Additionally, the axis can be adjusted by selecting portions of the plot to isolate.\n\n```{r}\n#| label: fig-lightintensity\n#| echo: false\n#| fig.cap: \"Total light intensity by time of day for each month based on photosynthetically active radiation (PAR) data collected at the Pellicer Creek weather station.\"\n\nggplotly(\nMET %>% \n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>% \n  select(datetimestamp, totpar) %>% \n  mutate(month = lubridate::month(datetimestamp, label = T), \n         day = lubridate::day(datetimestamp),\n         hour = lubridate::hour(datetimestamp),\n         minute = lubridate::minute(datetimestamp),\n         time = format(as.POSIXct(datetimestamp), format = \"%H:%M\")) %>% \n  group_by(month, time) %>% \n  summarize(intensity = sum(totpar, na.rm = T)) %>% \n  ungroup() %>% \n  mutate(time = strptime(time, format = \"%H:%M\", tz = \"\"),\n         datetime = as.POSIXct(time)) %>% \n  ggplot(aes(x = datetime, y = intensity, group = month)) +\n  geom_line(aes(color = month)) +\n  scale_x_datetime(date_breaks = \"hours\", \n                   date_labels = \"%H:%M\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5),\n        axis.text = element_text(color = \"black\")) +\n  labs(x = \"Time of Day (HH:MM)\",\n       y = \"Intensity of PAR (mMol/m-2)\")\n)\n```\n\n### Temperature\n\nAir and water temperatures are presented as daily averages (blue line) with historic ranges (daily range and average daily range) provided in shades of gray. \n\n```{r}\n#| label: fig-range-atemp\n#| echo: false\n#| fig.cap: \"Historical daily range of air temperature at the SWMP weather station with current year daily average overlaid in blue.\"\n\n  historical_daily_range(MET, param = 'atemp', target_yr = 2025) + labs(x = \"\", y = \"Air Temperature (\\u00B0C)\")\n  \n```\n\n```{r}\n#| label: fig-range-temp\n#| echo: false\n#| fig.cap: Historical daily range of water temperature at each SWMP water quality station with current year daily average overlaid in blue.\n#| fig.subcap:\n#|    - \"Pine Island\"\n#|    - \"San Sebastian\"\n#|    - \"Fort Matanzas\"\n#|    - \"Pellicer Creek\"\n#| layout-ncol: 2\n\nhistorical_daily_range(pi, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(ss, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(fm, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(pc, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n```\n\n### Salinity\n\n```{r}\n#| label: fig-range-sal\n#| echo: false\n#| fig.cap: Historical daily range of salinity at each SWMP water quality station with current year daily average overlaid in blue.\n#| fig.subcap:\n#|    - \"Pine Island\"\n#|    - \"San Sebastian\"\n#|    - \"Fort Matanzas\"\n#|    - \"Pellicer Creek\"\n#| layout-ncol: 2\n\nhistorical_daily_range(pi, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(ss, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(fm, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(pc, param = 'sal', target_yr = 2025)\n```\n\n\n","srcMarkdownNoYaml":"\n\n```{r}\n#| label: data-load\n#| include: false\nlibrary(here)\n\nsource(here::here('R', '00_loadpackages.R'))\nsource(here::here('R', '02.2_load_wrangle_WQ-and-MET.R'))\n\nload(here('output','data', 'MET.Rdata'))\n\nload(here('output','data', 'pi_wq.Rdata'))\nload(here('output','data', 'ss_wq.Rdata'))\nload(here('output','data', 'fm_wq.Rdata'))\nload(here('output','data', 'pc_wq.Rdata'))\n```\n\nThe following includes variables that establish the estuarine setting: rainfall, light intensity, water temperature, and salinity. These variables are driven primarily by climatic patterns and largely influence water quality, biological processes, and habitat condition.\n\n<!-- ## Summary -->\n<!-- Winter storm Finn (unofficially named) brought rainfall and strong winds in [January](https://www.actionnewsjax.com/news/local/strong-storm-cold-front-will-move-across-northeast-florida-southeast-georgia/DNJ3SOGJ35G4FCKJLPJNP67YZY/) to Northeast Florida causing some local schools to release students early and cancel after school activities (@fig-rainfall-1; @fig-rainfall-2). This event is discussed in further detail in the next chapter. -->\n\n<!-- Total measured rainfall in 2024 was 1347.2 mm (@fig-SeptPrecip-3). The third quarter of the year had the greatest rainfall total (@fig-rainfall) because of September, which had a record-setting high monthly total (@tbl-topRain; @fig-SeptPrecip-1; @fig-SeptPrecip-2). September also had the greatest number of rain days exceeding 10 mm/day (@Fig-rainfall-3), and more storms producing heavy rainfall (@Fig-rainfall-4). Rainfall totals for the fourth quarter of 2024 are incomplete, resulting from a computer program error. Data are missing beginning November 13, 2024, and continuing through the end of the year (see Maintenance Notes Section 8.2.2; @fig-SeptPrecip-4). -->\n\n<!-- Light intensity was highest from April to August. December had the lowest mid-day photosynthetically active radiation (PAR) (@fig-lightintensity). -->\n\n<!-- Daily average air temperatures were highest from June - August, and most variable during January – April and November – December (@fig-range-atemp). -->\n\n<!-- While there were some low water temperatures throughout the year, daily average water temperatures were generally higher than average (@fig-range-temp). Water temperature decreased in August and September with the onset of the large rain events causing water temperatures to fall below the historic average daily range at all four stations (@fig-range-temp-2; @fig-range-temp-3). Water temperatures increased at all four stations in November nearing the historic 2002-2024 maximum daily range  (@fig-range-temp). -->\n\n<!-- Rainfall in January and September – November brought salinity levels lower than their average daily ranges (@fig-range-sal), particularly at the stations farthest from the inlets (@fig-range-sal-1; @fig-range-sal-4). However, the drought conditions during spring increased salinity levels. Salinity stayed higher than the average daily range at all stations through July, but was most pronounced at Pine Island (@fig-range-sal-1).  -->\n\n## Data\n\n### Rainfall\n\n```{r}\n#| label: fig-rainfall\n#| echo: false\n#| fig.cap: Rainfall at the Pellicer Creek weather station. See Maintenance Notes (8.2.2) for details on missing data.\n#| fig.subcap:\n#|    - \"Quarterly total precipitation for 2025.\"\n#|    - \"Monthly total precipitation for 2025.\"\n#|    - \"Daily rainfall totals for days with greater than 1mm per day.\"\n#|    - \"Hourly rainfall intensity counts by category per month.\"\n#| layout-ncol: 2\n\n\n# QUARTERLY ----\n\nMET |> \n  SWMPrExtension::seasonal_barplot(param = 'totprcp',\n                                   season_grps = list(c(1,2,3), \n                                                      c(4,5,6), \n                                                      c(7,8,9), \n                                                      c(10, 11, 12)),\n                                   season_names = c('Jan-Mar', \n                                                    'Apr-Jun', \n                                                    'Jul-Sep', \n                                                    'Oct-Dec'),\n                                   hist_rng = c(2003,2025),\n                                   hist_avg = TRUE,\n                                   converted = F) + \n  theme(axis.text.x = element_text(angle = 45,\n                                   vjust = 0.6),\n        axis.text = element_text(color = \"black\"))\n\n\n## MONTHLY ----\n\nMET |> \n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>%\n  # mutate(date = as.Date(datetimestamp),\n  #        month = lubridate::month(date, label = T)) %>% \n  mutate(date = lubridate::date(datetimestamp),\n         month = lubridate::month(datetimestamp, label = TRUE)) %>% \n  group_by(month) %>%\n  summarise(sum = sum(totprcp, na.rm = T)) %>%\n  # summarise(mean = mean(sum)) %>%\n  ggplot(aes(x = month, y = sum)) +\n  geom_col(fill = \"#0075AC\") +\n  geom_hline(yintercept = 121.2, linewidth = 1, linetype = \"dashed\", color = \"grey50\") +\n  geom_text(aes(label = sum), vjust = 1.5, color = \"white\") +\n  scale_y_continuous(expand = c(0,0)) +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  # geom_text(aes(x = \"Mar\", y = 75), \n  #           label = \"69.8 mm\",\n  #           size = 4.5,\n  #           color = \"grey50\") +\n  labs(x = '',\n       y = 'Precipitation (mm)',\n       caption = \"Hortizontal line represents monthly average.\")\n\n## DAILY ----\n\nfun_in <- function(x) sum(x, na.rm = TRUE)\n\nMET |> \n  filter(datetimestamp > '2025-01-01 00:15' & datetimestamp < '2025-11-01 00:00') %>%\n  aggreswmp(by = \"days\", FUN = fun_in, params = \"totprcp\") %>% \n  filter(totprcp >= 1) %>% \n  mutate(date = as.Date(datetimestamp),\n         month = lubridate::month(date, label = T),\n         prcp_in = totprcp * 0.0393701,\n         prcp_in = round(prcp_in, digits = 1),\n         wet = case_when(totprcp < 10 ~ \"Not Very Wet (<10mm)\",\n                         totprcp >= 10 & totprcp < 20 ~ \"Wet (10-19mm)\",\n                         totprcp >= 20 & totprcp < 30 ~ \"Very Wet (20-29mm)\",\n                         totprcp > 30 ~ \"Extremely Wet (>30mm)\"),\n         wet = factor(wet, levels = c(\"Not Very Wet (<10mm)\",\n                                      \"Wet (10-19mm)\",\n                                      \"Very Wet (20-29mm)\",\n                                      \"Extremely Wet (>30mm)\"))) %>% \n  ggplot(aes(x = date, y = totprcp)) +\n  geom_segment(aes(x = date, xend = date, y = 0, yend = totprcp),\n               size = 1) +\n  geom_point(aes(color = wet), size =2, bg = 4) +\n  khroma::scale_color_okabeito() + # change color codes\n  scale_y_continuous(expand = c(0,0), limits = c(0,70)) +\n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\") +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  labs(x = '',\n       y = 'Total Daily Precipitation (mm)',\n       color = \"Amount of Rain\")\n\n## INTENSITY ----\n\n# rainfall intensity \n# in mm/hr\n\nfun_in <- function(x) sum(x, na.rm = TRUE)\n\nMET |>\n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>% \n  aggreswmp(by = \"hours\", FUN = fun_in, params = \"totprcp\") %>% \n  rename(intensity = totprcp) %>% \n  mutate(date = lubridate::date(datetimestamp),\n         month = lubridate::month(datetimestamp, label = TRUE),\n         intensity_cat = case_when(intensity == 0 ~ \"No Rain (0 mm/hr)\",\n                                    intensity > 0 & intensity < 2.5 ~ \"Light Rain (<2.5 mm/hr)\",\n                                    intensity >= 2.5 & intensity < 7.6 ~ \"Moderate Rain (2.5-7.6 mm/hr)\",\n                                    intensity >= 7.6 & intensity < 50 ~ \"Heavy Rain (7.6-50 mm/hr)\",\n                                    intensity > 30 ~ \"Intense Rain (>50mm/hr)\"),\n         intensity_cat = factor(intensity_cat, levels = c(\"No Rain (0 mm/hr)\",\n                                                          \"Light Rain (<2.5 mm/hr)\",\n                                                          \"Moderate Rain (2.5-7.6 mm/hr)\",\n                                                          \"Heavy Rain (7.6-50 mm/hr)\",\n                                                          \"Intense Rain (>50mm/hr)\")\n                                )\n         ) %>% \n  # group_by(month, intensity_cat) %>%\n  # count() %>%\n  filter(intensity_cat != \"No Rain (0 mm/hr)\") %>% \n  ggplot() +\n  geom_bar(aes(x = month, fill = intensity_cat)) +\n  ggthemes::scale_fill_colorblind() +\n  scale_y_continuous(expand = c(0,0)) +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\n  labs(x = \"\",\n       y = \"Amount of Hours\",\n       fill = \"Intensity Category\")\n```\n\n```{r}\n#| label: tbl-topRain\n#| echo: false\n#| tbl-cap: \"Top five highest monthly rainfall totals.\"\n\n# MET %>% \n#   (filter(datetimestamp < '2026-01-01 00:00'))\n\nMonthly_PRCP<-aggreswmp(MET, 'months', function(x) sum(x, na.rm = T), \nparams = 'totprcp')\n\nMonthly_PRCP$Month <- format(Monthly_PRCP$datetimestamp, \"%b\")\nMonthly_PRCP$Year <- year(Monthly_PRCP$datetimestamp)\nMonthly_PRCP$Month_number <- month(Monthly_PRCP$datetimestamp)\n\nTopValues <- Monthly_PRCP %>% \n  top_n(5, totprcp) %>%\n  arrange(desc(totprcp)) \n\nTopValues %>%\n  select(Month,Year,totprcp) %>% \n  rename(`Total Precipitation (mm)` = 'totprcp') %>% \n  kbl(align = \"c\") %>%\n  kable_styling(fixed_thead = T) %>% \n  column_spec(3, border_left = T)\n\n```\n\n```{r}\n#| label: fig-SeptPrecip\n#| echo: false\n#| fig.cap: Rainfall at the Pellicer Creek weather station.\n#| fig.subcap:\n#|    - \"Monthly total precipitation 2002-2025.\"\n#|    - \"Annual precipitation totals Jan 2002-Dec 2024.\"\n#|    #|    - \"Total precipitation for September 2002-2024.\"\n#|    #|    - \"Annual precipitation totals Jan 2002-Dec 2024.\"\n#| layout-ncol: 2\n# ## September Precip ----\n# \n# Monthly_PRCP %>%\n#   filter(Month == \"Sep\", na.rm=TRUE) %>%\n#   ggplot(aes(Year, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   #scale_x_date(date_labels = \"%y\") +\n#   labs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n## MONTHLY/YEAR ----\n\n# Plotting\nggplot(Monthly_PRCP, aes(datetimestamp, totprcp)) +\n  geom_segment(aes(x=datetimestamp, xend=datetimestamp, y=0, yend=totprcp), colour = \"#0075AC\") +\n  theme_classic() +\n  theme(axis.text = element_text(color = \"black\", size = 12),\n        axis.title.y = element_text(color = \"black\", size = 12)) +\nlabs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n## Seasonal Precip ----\n# seasonal_barplot(MET, param = 'totprcp')\n\n## BOXPLOT ----\n# raw_boxplot(MET, param = 'totprcp')\n\n# seasonal_boxplot(MET, param = 'totprcp', target_yr = 2024)\n\n# box_rain <- ggplot(Monthly_PRCP, aes(x = Month, y = totprcp, fill = Month)) + \n#   geom_boxplot(fill = \"#56B4E9\") +\n#   scale_x_discrete(limits = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec')) +\n#   geom_point(data = filter(Monthly_PRCP, Year == 2024), \n#                  aes(color = \"2024\"), size = 4) +\n#   scale_color_manual(name = \"\", values = c(\"2024\" = \"red\")) +\n#   scale_fill_manual(name = \"\", values = c(\"2002-2024\" = \"white\")) +\n#   theme_classic() +\n#   theme(legend.position = \"bottom\", axis.text = element_text(color = \"black\", size = 12),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   labs(x = '',\n#        y = 'Precipitation (mm)')\n#   box_rain\n\n#Boxplots another way\n\nboxplot_prcp <- ggplot(data = Monthly_PRCP, \n                      aes(x = Month, y = totprcp)) +\n      geom_boxplot(data = filter(Monthly_PRCP, Year < 2025), \n                   aes(fill = \"2002-2024\")) +\n      geom_point(data = filter(Monthly_PRCP, Year == 2025), \n                 aes(color = \"2025\"),\n                 size = 4) +\n      scale_x_discrete(limits = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec')) +\n      scale_color_manual(name = \"\", \n                         values = c(\"2025\" = \"red\")) +\n      scale_fill_manual(name = \"\",\n                        values = c(\"2002-2025\" = \"white\")) +\n      theme_classic() +\n      theme(legend.position = \"bottom\",\n            axis.text = element_text(color = \"black\")) +\n      labs(x = \"\", y = 'Precipitation (mm)')\n    boxplot_prcp\n\n## YEAR ----\n\n# Plotting\n\n# fun_in <- function(x) sum(x, na.rm = TRUE)\n# \n# MET |> \n#   filter(datetimestamp > '2003-01-01 00:15' & datetimestamp < '2025-01-01 00:00') %>%\n#   aggreswmp(by = \"years\", FUN = fun_in, params = \"totprcp\") %>% \n#   ggplot(aes(datetimestamp, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   geom_text(aes(label = totprcp), vjust = -0.5, color = \"black\", size = 2) +\n#   labs(title = \"\", x = \"\", y = \"Precipitation (mm)\")\n\n#Another way\n\n# Monthly_PRCP %>%\n#   ggplot(aes(Year, totprcp)) +\n#   geom_col(fill = \"#0075AC\") +\n#   theme_classic() +\n#   theme(axis.text = element_text(color = \"black\", size = 12), #angle=45, vjust=1, hjust=1),\n#         axis.title.y = element_text(color = \"black\", size = 12)) +\n#   geom_text(aes(label = totprcp), vjust = 1.5, color = \"white\") +\n#   #scale_x_date(date_labels = \"%y\") +\n#   labs(title = \"\", x = \"\", y = \"Total Annual Precipitation (mm)\")\n\n\n```\n\n### Light Intensity\n\nThe plot below is interactive. Clicking on elements in the legend (months) will select or deselect months of interest. Additionally, the axis can be adjusted by selecting portions of the plot to isolate.\n\n```{r}\n#| label: fig-lightintensity\n#| echo: false\n#| fig.cap: \"Total light intensity by time of day for each month based on photosynthetically active radiation (PAR) data collected at the Pellicer Creek weather station.\"\n\nggplotly(\nMET %>% \n  filter(datetimestamp > '2025-01-01 00:15'& datetimestamp < '2025-11-01 00:00') %>% \n  select(datetimestamp, totpar) %>% \n  mutate(month = lubridate::month(datetimestamp, label = T), \n         day = lubridate::day(datetimestamp),\n         hour = lubridate::hour(datetimestamp),\n         minute = lubridate::minute(datetimestamp),\n         time = format(as.POSIXct(datetimestamp), format = \"%H:%M\")) %>% \n  group_by(month, time) %>% \n  summarize(intensity = sum(totpar, na.rm = T)) %>% \n  ungroup() %>% \n  mutate(time = strptime(time, format = \"%H:%M\", tz = \"\"),\n         datetime = as.POSIXct(time)) %>% \n  ggplot(aes(x = datetime, y = intensity, group = month)) +\n  geom_line(aes(color = month)) +\n  scale_x_datetime(date_breaks = \"hours\", \n                   date_labels = \"%H:%M\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5),\n        axis.text = element_text(color = \"black\")) +\n  labs(x = \"Time of Day (HH:MM)\",\n       y = \"Intensity of PAR (mMol/m-2)\")\n)\n```\n\n### Temperature\n\nAir and water temperatures are presented as daily averages (blue line) with historic ranges (daily range and average daily range) provided in shades of gray. \n\n```{r}\n#| label: fig-range-atemp\n#| echo: false\n#| fig.cap: \"Historical daily range of air temperature at the SWMP weather station with current year daily average overlaid in blue.\"\n\n  historical_daily_range(MET, param = 'atemp', target_yr = 2025) + labs(x = \"\", y = \"Air Temperature (\\u00B0C)\")\n  \n```\n\n```{r}\n#| label: fig-range-temp\n#| echo: false\n#| fig.cap: Historical daily range of water temperature at each SWMP water quality station with current year daily average overlaid in blue.\n#| fig.subcap:\n#|    - \"Pine Island\"\n#|    - \"San Sebastian\"\n#|    - \"Fort Matanzas\"\n#|    - \"Pellicer Creek\"\n#| layout-ncol: 2\n\nhistorical_daily_range(pi, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(ss, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(fm, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n\nhistorical_daily_range(pc, param = 'temp', target_yr = 2025) + labs(x = \"\", y = \"Water Temperature (\\u00B0C)\")\n```\n\n### Salinity\n\n```{r}\n#| label: fig-range-sal\n#| echo: false\n#| fig.cap: Historical daily range of salinity at each SWMP water quality station with current year daily average overlaid in blue.\n#| fig.subcap:\n#|    - \"Pine Island\"\n#|    - \"San Sebastian\"\n#|    - \"Fort Matanzas\"\n#|    - \"Pellicer Creek\"\n#| layout-ncol: 2\n\nhistorical_daily_range(pi, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(ss, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(fm, param = 'sal', target_yr = 2025)\n\nhistorical_daily_range(pc, param = 'sal', target_yr = 2025)\n```\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"code-overflow":"wrap","engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["lightbox"],"toc":true,"toc-depth":3,"output-file":"environmental.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","bibliography":["../text/references.bib","references.bib"],"lightbox":"auto","theme":["cosmo","../swmp.scss"],"title":"Environmental"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}